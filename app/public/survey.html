<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
	<html lang="en-us">
		<meta charset="UTF-8">

		<head>
			<title>Friend Finder</title>

			<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

			<link rel="stylesheet" type="text/css" href="style.css">

			<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

			<!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> -->

			<script type="text/javascript" src="../data/friends.js"></script> 

		</head>


		<body>

			

			
			<div class="container">

					<div class="modal" id="mymodal">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<h3>Your New Friend!</h3>
								</div>
								<div class="modal-body">
									<p>Your new friend is... <span id="friend"></span></p>
								</div>
								<div class="modal-footer">
									<button class="btn btn-default" id="close" data-dismiss="modal">Close</button>
								</div>
							</div>	
						</div>
					</div>

				<h2>Survey Questions</h2>

				<hr>

				<h3><strong>About You</strong></h3>
				<form>
					<h4>Name (Required)</h4>
					<input type="text" id="name" class="form-control" required>
					<h4>Link to Photo Image (Required)</h4>
					<input type="file" id="photo" required>
					<hr>

					<h3><strong>Question 1</strong></h3>
					<h4>Your mind is always buzzing with unexplored ideas and plans.</h4>

					<div id="chooseSelect-1">
					</div>

					<h3><strong>Question 2</strong></h3>
					<h4>Generally speaking, you rely more on your experience than your imagination.</h4>

					<div id="chooseSelect-2">
					</div>



					<h3><strong>Question 3</strong></h3>
					<h4>You find it easy to stay relaxed and focused even when there is some pressure.</h4>

					<div id="chooseSelect-3">
					</div>


					<h3><strong>Question 4</strong></h3>
					<h4>You rarely do something just out of sheer curiosity.</h4>

					<div id="chooseSelect-4">
					</div>



					<h3><strong>Question 5</strong></h3>
					<h4>People can rarely upset you.</h4>

					<div id="chooseSelect-5">
					</div>



					<h3><strong>Question 6</strong></h3>
					<h4>It is often difficult for you to relate to other people’s feelings.</h4>

					<div id="chooseSelect-6">
					</div>



					<h3><strong>Question 7</strong></h3>
					<h4>In a discussion, truth should be more important than people’s sensitivities.</h4>

					<div id="chooseSelect-7">
					</div>



					<h3><strong>Question 8</strong></h3>
					<h4>You rarely get carried away by fantasies and ideas.</h4>

					<div id="chooseSelect-8">
					</div>



					<h3><strong>Question 9</strong></h3>
					<h4>You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</h4>

					<div id="chooseSelect-9">
					</div>



					<h3><strong>Question 10</strong></h3>
					<h4>You feel more energetic after spending time with a group of people.</h4>

					<div id="chooseSelect-10">
					</div>

					<br>
					<hr>

					<button class="btn btn-primary btn-lg" type="submit" value="Submit" data-target="#mymodal">Submit</button>
					<!-- data-toggle="modal" -->
				</form>

							<span><a href="/api/friends">API Friends List</a> | <a href="https://github.com/mkmorfess/FriendFinder">GitHub Repo</a></span>



					
				
				
			</div>


		<script>

$(document).ready(function(){


//This function creates the 10 drop downs for the questions each with 5 numbers to choose from

	function createQuestions() {
		var idNum = 1;


		for (var i = 0; i < 10; i++) {

			var newSelect = $("<select>");
			newSelect.addClass("form-control")
		
			newSelect.attr("id", "q" + idNum);

			$("#chooseSelect-" + idNum).html(newSelect);

			for (var j = 0; j < 6; j++) {

				if (j === 0) {
					var options = $("<option>");
					options.text("Please Choose A Number");
					newSelect.append(options);
				}
				else if (j === 1) {
					var options = $("<option>");
					options.attr("value", j);
					options.text(j + " - (Strongly Disagree)");
					newSelect.append(options);
				}

				else if (j === 5) {
					var options = $("<option>");
					options.attr("value", j);
					options.text(j + " - (Strongly Agree)");
					newSelect.append(options);
				}

				else{

					var options = $("<option>");
					options.attr("value", j);
					options.text(j);
					newSelect.append(options);
				}
			
			}

			idNum++
		}

	}

	createQuestions();

	//here is the submit button function which takes in the user values and posts them...

	$("form").submit(function(event){

		event.preventDefault();
			
		var newPerson = {
			name: $("#name").val().trim(),
			photo: $("#photo").val().trim(),
			scores: []
		}
			

		for (var i = 1; i < 11; i++) {

			newPerson.scores.push($("#q" + i).val())
		// 	console.log(newPerson.scores)
		}

		if (newPerson.scores.includes("Please Choose A Number")) {

			alert("Please Answer All The Questions")
			newPerson.scores = [];

		}

		else {

			var matches = [];

			// var newFriend = new NewFriend(newPerson.name, newPerson.photo, newPerson.scores);

			// matches.push(newFriend);

			
			// console.log(matches);
			// console.log(currentEntry);
			// console.log(currentName);
			// console.log(currentScores);

			// var currentEntry = data.matches[matches.length -1];
			// var currentName = currentEntry.name;
			// var currentScores = currentEntry.scores;

			var currentEntry;
			var currentName;
			var currentScores;

			$.post("/api/new", newPerson)
  				.done(function(data) {
  					console.log("This is POST data log __")
    				console.log(data);
    			// 	alert("Adding character...");
  			});

  			$.get("/api/" + newPerson.name, function(newData) {
  				console.log("This is GET data log __")
    			console.log(newData.name);
    			currentEntry = newData;
    			currentName = newData.name;
    			currentScores = newData.scores;
 				// console.log(currentEntry);
				// console.log(currentName);
				// console.log(currentScores);
    			
    		

    			$.get("/api", function(data) {
    			console.log("This is the 2nd GET request");
    			console.log(data);
	    			for (var i = 0; i < data.length - 1; i++) {
	    				matches.push(data[i]);
	    			}
	    			console.log("This is the matches")
	    			console.log(matches)
	    			


	    		

		    		console.log("THIS IS THE STUFF OUTSIDE THE GET STUFF")
		    		console.log(currentEntry);
		    		console.log(matches);
		    		console.log("______________________________________")

		    		

					$("#name").val("")
					$("#photo").val("")

					for (var i = 1; i < 11; i++) {
						$("#q" + i).val("Please Choose A Number");
					}

					if (matches.length < 2) {

						alert("Not enough friends have entered in... ")
					}

					else {

						var names = [];
						var scores = [];
						var add = 0

						for (var i = 0; i < matches.length - 1; i++){

							var currentMatch = matches[i];
							names.push(currentMatch.name);
							console.log(currentMatch);

							for (var j = 0; j < currentMatch.scores.length; j++) {

								add += Math.abs(currentEntry.scores[j] - currentMatch.scores[j])

							}

							scores.push(add);

							add = 0;
							// console.log(names);
							// console.log(scores);


						}

						//https://forums.adobe.com/thread/1062126 -- Nice bubble sort code

						bubbleSort(scores,names);  

						function bubbleSort(a,b)  {  
						    var swapped;  
						    do {  
						        swapped = false;  
						        for (var i=0; i < a.length-1; i++) {  
						            if (a[i] > a[i+1])   
						            {  
						                var temp = a[i];  
						                a[i] = a[i+1];  
						                a[i+1] = temp;  
						  
						  
						  
						  
						                var temp = b[i];  
						                b[i] = b[i+1];  
						                b[i+1] = temp;  
						                swapped = true;  
						            }  
						        }  
						    } while (swapped);  
						}  

							// console.log(names);
							// console.log(scores);


						if (scores.length === 1) {
							$("#friend").html(names[0] + "!")
							$("#mymodal").show();
							
							// alert("Your match is... " + names[0]);
						}

						else if (scores.length > 1) {
							var closerMatches = [];
							for (var i = 0; i < scores.length; i++) {
								if (scores[i] === scores[i + 1]) {
									closerMatches.push(names[i]);
									
								}
								else {
									closerMatches.push(names[i]);
									break;
								}

							}

							if (closerMatches.length > 0) {
								// console.log(closerMatches);
								var randomMatch = closerMatches[Math.floor(Math.random() * closerMatches.length)];

								$("#friend").html(randomMatch + "!")
								$("#mymodal").show();
								// alert("Your match is... " + randomMatch);
							}

							else {
								$("#friend").html(names[0] + "!")
								$("#mymodal").show();
								// alert("Your match is... " + names[0]);
							}

						}


					}
				})
			})
			
		}

			

			
		})

		$("#close").click(function(){
			$("#mymodal").hide();
		})

})



		</script>
		


  
		</body>

	</html>